<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The NIPALS algorithm • nipals</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="The NIPALS algorithm">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">nipals</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/nipals_algorithm.html">The NIPALS algorithm</a>
    </li>
    <li>
      <a href="../articles/nipals_comparisons.html">Comparing results and performance of NIPALS functions in R</a>
    </li>
    <li>
      <a href="../articles/nipals_optimization.html">NIPALS optimization notes</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>The NIPALS algorithm</h1>
                        <h4 class="author">Kevin Wright</h4>
            
            <h4 class="date">2019-09-13</h4>
      
      
      <div class="hidden name"><code>nipals_algorithm.Rmd</code></div>

    </div>

    
    
<p>The principal components of <span class="math inline">\(\bf X'X\)</span>, where <span class="math inline">\(\bf X\)</span> is a column-centered matrix, can be found by several methods, including SVD and NIPALS.</p>
<div id="singular-value-decomposition" class="section level1">
<h1 class="hasAnchor">
<a href="#singular-value-decomposition" class="anchor"></a>Singular value decomposition</h1>
<p>The SVD (Singular Value Decomposition) of a matrix <span class="math inline">\(X\)</span> is <span class="math display">\[
\bf X = U S V',
\]</span> where <span class="math inline">\(\bf U\)</span> <span class="math inline">\((n \times r)\)</span> and <span class="math inline">\(\bf V\)</span> <span class="math inline">\((k \times r)\)</span> are orthogonal matrices and <span class="math inline">\(\bf S\)</span> is a diagonal matrix of <span class="math inline">\(r\)</span> singular values.</p>
<p>SVD does not allow missing values in the data.</p>
</div>
<div id="nipals" class="section level1">
<h1 class="hasAnchor">
<a href="#nipals" class="anchor"></a>NIPALS</h1>
<p>The NIPALS (Nonlinear Iterative Partial Least Squares) algorithm can be used to find the first few (or all) principal components with the decomposition <span class="math display">\[
\bf X = \bf T \bf P '
\]</span> where the columns of <span class="math inline">\(\bf T\)</span> are called <em>scores</em> and the columns of <span class="math inline">\(\bf P\)</span> (the rows of <span class="math inline">\(\bf P'\)</span>) are called the <em>loadings</em>.</p>
<p>The algorithm begins by initializing <span class="math inline">\(h=1\)</span> and <span class="math inline">\(\bf X_h = \bf X\)</span>, then proceeds through the following basic steps:</p>
<ol style="list-style-type: decimal">
<li>Choose <span class="math inline">\(\bf t_h\)</span> as any column of <span class="math inline">\(\bf X_h\)</span>.</li>
<li>Compute loadings <span class="math inline">\(\bf p_h = X_h' t_h / t_h' t_h\)</span>.</li>
<li>Let <span class="math inline">\(\bf p_h = p_h / \sqrt{p_h' p_h}\)</span>.</li>
<li>Compute scores <span class="math inline">\(\bf t_h = X_h p_h / p_h' p_h\)</span>.</li>
</ol>
<p>Repeat (3) and (4) until convergence for the <span class="math inline">\(h^{th}\)</span> principal component.</p>
<p>Let <span class="math inline">\(\bf X_{h+1} = \bf X_h - t_h p_h'\)</span>. Let <span class="math inline">\(\lambda_h = \bf t_h' t\)</span> (eigen value). Increment <span class="math inline">\(h = h + 1\)</span> and repeat for the next principal component.</p>
<p>Assemble the columns of <span class="math inline">\(\bf T\)</span> from the <span class="math inline">\(\bf t_h\)</span> and the columns of <span class="math inline">\(\bf P\)</span> from the vectors <span class="math inline">\(\bf p_h\)</span>.</p>
<p>The resulting PCs may be scaled in different ways. One way to scale the PCA solution is to define the loadings <span class="math inline">\(\bf P = V\)</span> and <span class="math inline">\(\bf T = U'S\)</span>.</p>
<div id="missing-data" class="section level2">
<h2 class="hasAnchor">
<a href="#missing-data" class="anchor"></a>Missing data</h2>
<p>The NIPALS algorithm can be modified to accommodate missing values using the method of <span class="citation">Martens and Martens (2001)</span> (p. 381).</p>
<p>If, for a certain variable <span class="math inline">\(k\)</span> [column of <span class="math inline">\(\bf X\)</span>], a missing value is encountered in <span class="math inline">\(\bf X\)</span> for a certain object <span class="math inline">\(i\)</span> [row of <span class="math inline">\(\bf X\)</span>], then the corresponding elements in <span class="math inline">\(\bf t_{ih}\)</span> must also be skipped in the calculation of the loadings, which for <span class="math inline">\(\bf X\)</span>-variable <span class="math inline">\(k\)</span> is <span class="math display">\[ 
\bf p_{hk} = X_{k,h-1} t_h'  / (t_h' t_h) .
\]</span></p>
<p>Likewise, if, for a certain sample <span class="math inline">\(i\)</span> [row of <span class="math inline">\(\bf X\)</span>], a missing value is encountered in <span class="math inline">\(\bf X\)</span> for a certain variable <span class="math inline">\(k\)</span> [column of <span class="math inline">\(\bf X\)</span>], then the corresponding elements in <span class="math inline">\(\bf p_{kh}\)</span> must also be skipped in calculating the scores, which for sample <span class="math inline">\(i\)</span> is <span class="math display">\[ 
\bf t_{ih} = X_{i,h-1} p_h / (p_h' p_h) 
\]</span> This method may have convergence problems if there are many missing values.</p>
</div>
<div id="gram-schmidt-orthogonalization" class="section level2">
<h2 class="hasAnchor">
<a href="#gram-schmidt-orthogonalization" class="anchor"></a>Gram-Schmidt orthogonalization</h2>
<p>Because of the accumulation of floating-point errors, the orthogonality of the principal components is quickly lost as the number of components increases. <span class="citation">Andrecut (2009)</span> provided a Gram-Schmidt modified version of NIPALS that stabilizes the orthogonality by re-orthogonalizing the scores and loadings at each iteration. The ‘corrected’ terms are:</p>
<p><span class="math display">\[
\bf p_c = p - P_{1:h} P_{1:h}' p
\]</span> and</p>
<p><span class="math display">\[
\bf t_c = t - T_{1:h} T_{1:h}' t
\]</span> where <span class="math inline">\(\bf P_{1:h}\)</span> and <span class="math inline">\(\bf T_{1:h}\)</span> are the loadings and scores matrices based on the first <span class="math inline">\(h\)</span> principal components. Since <span class="math inline">\(\bf P_{1:h} P_{1:h}'\)</span> only needs to be calculated once for each PC (and incrementally), the orthogonalization is not very computationally expensive.</p>
<p>This correction method is also used by SAS PROC HPPRINCOMP (which does not allow missing values).</p>
</div>
<div id="example-1" class="section level2">
<h2 class="hasAnchor">
<a href="#example-1" class="anchor"></a>Example 1</h2>
<p>A small dataset with two missing values.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(nipals)</a></code></pre></div>
<pre><code>## Loading required package: nipals</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">B &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">50</span>, <span class="dv">67</span>, <span class="dv">90</span>, <span class="dv">98</span>, <span class="dv">120</span>,</a>
<a class="sourceLine" id="cb3-2" title="2">              <span class="dv">55</span>, <span class="dv">71</span>, <span class="dv">93</span>, <span class="dv">102</span>, <span class="dv">129</span>,</a>
<a class="sourceLine" id="cb3-3" title="3">              <span class="dv">65</span>, <span class="dv">76</span>, <span class="dv">95</span>, <span class="dv">105</span>, <span class="dv">134</span>,</a>
<a class="sourceLine" id="cb3-4" title="4">              <span class="dv">50</span>, <span class="dv">80</span>, <span class="dv">102</span>, <span class="dv">130</span>, <span class="dv">138</span>,</a>
<a class="sourceLine" id="cb3-5" title="5">              <span class="dv">60</span>, <span class="dv">82</span>, <span class="dv">97</span>, <span class="dv">135</span>, <span class="dv">151</span>,</a>
<a class="sourceLine" id="cb3-6" title="6">              <span class="dv">65</span>, <span class="dv">89</span>, <span class="dv">106</span>, <span class="dv">137</span>, <span class="dv">153</span>,</a>
<a class="sourceLine" id="cb3-7" title="7">              <span class="dv">75</span>, <span class="dv">95</span>, <span class="dv">117</span>, <span class="dv">133</span>, <span class="dv">155</span>), <span class="dt">ncol=</span><span class="dv">5</span>, <span class="dt">byrow=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb3-8" title="8">B2 &lt;-<span class="st"> </span>B</a>
<a class="sourceLine" id="cb3-9" title="9">B2[<span class="dv">1</span>,<span class="dv">1</span>] &lt;-<span class="st"> </span>B2[<span class="dv">2</span>,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb3-10" title="10">m0 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/svd.html">svd</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/scale.html">scale</a></span>(B)) <span class="co"># center and scale</span></a></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="st">"nipals"</span>)</a>
<a class="sourceLine" id="cb4-2" title="2">m1 &lt;-<span class="st"> </span>nipals<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/nipals/man/nipals.html">nipals</a></span>(B2, <span class="dt">gramschmidt=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb4-3" title="3">m2 &lt;-<span class="st"> </span>nipals<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/nipals/man/nipals.html">nipals</a></span>(B2, <span class="dt">gramschmidt=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<p>Model <code>m1</code> omits the Gram-Schmidt orthogonalization step at each iteration. Model <code>m2</code> includes it.</p>
<p>The eigenvalues for the two models are very similar.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>( m1<span class="op">$</span>eig, <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## [1] 4.876 2.044 1.073 0.237 0.143</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>( m2<span class="op">$</span>eig, <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## [1] 4.876 2.035 1.079 0.234 0.133</code></pre>
<p>In theory, the loadings matrix <span class="math inline">\(\bf P\)</span> is orthogonal so that <span class="math inline">\(\bf P' P = I\)</span>. If there are missing values, however, then the calculation of approximate PCs causes numerical errors to accumulate, so that in practice only the first few components can be accurately calculated. (The coordinates of the last PC can often be quite poor.)</p>
<p>In this small example, the first 3 PCs of model <code>m1</code> are fairly orthogonal, but the 4th and 5th PC are not so good. For model <code>m2</code>, the PCs are nearly exactly orthogonal.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="co"># loadings</span></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>( <span class="kw"><a href="https://rdrr.io/r/base/crossprod.html">crossprod</a></span>(m1<span class="op">$</span>loadings), <span class="dv">3</span>) <span class="co"># P'P = t(P) %*% P</span></a></code></pre></div>
<pre><code>##        PC1    PC2    PC3    PC4    PC5
## PC1  1.000  0.011  0.006 -0.043 -0.416
## PC2  0.011  1.000 -0.011 -0.003  0.125
## PC3  0.006 -0.011  1.000 -0.050 -0.058
## PC4 -0.043 -0.003 -0.050  1.000 -0.006
## PC5 -0.416  0.125 -0.058 -0.006  1.000</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>( <span class="kw"><a href="https://rdrr.io/r/base/crossprod.html">crossprod</a></span>(m2<span class="op">$</span>loadings), <span class="dv">3</span>)</a></code></pre></div>
<pre><code>##     PC1 PC2 PC3 PC4 PC5
## PC1   1   0   0   0   0
## PC2   0   1   0   0   0
## PC3   0   0   1   0   0
## PC4   0   0   0   1   0
## PC5   0   0   0   0   1</code></pre>
<p>Also in theory, <span class="math inline">\(\bf T' T = I\)</span> (if eigenvalues are removed from T), but missing values again invalidate this identity, unless the Gram-Schmidt method is used.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="co"># scores</span></a>
<a class="sourceLine" id="cb13-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>( <span class="kw"><a href="https://rdrr.io/r/base/crossprod.html">crossprod</a></span>(m1<span class="op">$</span>scores), <span class="dv">3</span>) <span class="co"># T'T = t(T) %*% T</span></a></code></pre></div>
<pre><code>##        PC1    PC2    PC3    PC4    PC5
## PC1  1.000 -0.086  0.058 -0.287  0.218
## PC2 -0.086  1.000  0.003 -0.014  0.003
## PC3  0.058  0.003  1.000  0.013 -0.002
## PC4 -0.287 -0.014  0.013  1.000  0.004
## PC5  0.218  0.003 -0.002  0.004  1.000</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>( <span class="kw"><a href="https://rdrr.io/r/base/crossprod.html">crossprod</a></span>(m2<span class="op">$</span>scores), <span class="dv">3</span>)</a></code></pre></div>
<pre><code>##     PC1 PC2 PC3 PC4 PC5
## PC1   1   0   0   0   0
## PC2   0   1   0   0   0
## PC3   0   0   1   0   0
## PC4   0   0   0   1   0
## PC5   0   0   0   0   1</code></pre>
</div>
</div>
<div id="bibliography" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#bibliography" class="anchor"></a>Bibliography</h1>
<div id="refs" class="references">
<div id="ref-andrecut2009parallel">
<p>Andrecut, Mircea. 2009. “Parallel GPU Implementation of Iterative PCA Algorithms.” <em>Journal of Computational Biology</em> 16 (11): 1593–9. <a href="https://doi.org/10.1089/cmb.2008.0221">https://doi.org/10.1089/cmb.2008.0221</a>.</p>
</div>
<div id="ref-martens2001multivariate">
<p>Martens, Harald, and Magni Martens. 2001. <em>Multivariate Analysis of Quality: An Introduction</em>. J.Wiley &amp; Sons.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#singular-value-decomposition">Singular value decomposition</a></li>
      <li>
<a href="#nipals">NIPALS</a><ul class="nav nav-pills nav-stacked">
<li><a href="#missing-data">Missing data</a></li>
      <li><a href="#gram-schmidt-orthogonalization">Gram-Schmidt orthogonalization</a></li>
      <li><a href="#example-1">Example 1</a></li>
      </ul>
</li>
      <li><a href="#bibliography">Bibliography</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Kevin Wright.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.0.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
