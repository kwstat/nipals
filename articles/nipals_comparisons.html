<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Comparing results and performance of NIPALS functions in R • nipals</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Comparing results and performance of NIPALS functions in R">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nipals</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/empca_notes.html">EMPCA notes</a></li>
    <li><a class="dropdown-item" href="../articles/nipals_algorithm.html">The NIPALS algorithm</a></li>
    <li><a class="dropdown-item" href="../articles/nipals_comparisons.html">Comparing results and performance of NIPALS functions in R</a></li>
    <li><a class="dropdown-item" href="../articles/nipals_optimization.html">NIPALS optimization notes</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/kwstat/nipals/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Comparing results and performance of NIPALS functions in R</h1>
                        <h4 data-toc-skip class="author">Kevin
Wright</h4>
            
            <h4 data-toc-skip class="date">2017-10-27</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/kwstat/nipals/blob/main/vignettes/nipals_comparisons.Rmd" class="external-link"><code>vignettes/nipals_comparisons.Rmd</code></a></small>
      <div class="d-none name"><code>nipals_comparisons.Rmd</code></div>
    </div>

    
    
<p>There are at least 5 R packages with a function for performing NIPALS
on a matrix that contains missing values: &gt;&gt;&gt;&gt;&gt;&gt;&gt;
empca</p>
<ol style="list-style-type: decimal">
<li><code>ade4::nipals</code></li>
<li><code>mixOmics::nipals</code></li>
<li><code><a href="../reference/nipals.html">nipals::nipals</a></code></li>
<li><code>plsdepot::nipals</code></li>
<li>
<code>pcaMethods::nipalsPca</code> and
<code>pcaMethods::RnipalsPca</code>.</li>
</ol>
<p>These functions have slightly different scalings for the returned
values, and were written with different coding styles. With careful
attention to some of the scaling details of the returned values,
packages 1-4 produce the same results. However, there are dramatic
differences in speed. (Number 5 was added to the list later and is not
included in the comparisons).</p>
<p>There are other R packages with a NIPALS function that do NOT allow
missing values (which are not considered here):</p>
<ol style="list-style-type: decimal">
<li><code>mvdalab::pca.nipals</code></li>
</ol>
<div class="section level2">
<h2 id="example-data">Example data<a class="anchor" aria-label="anchor" href="#example-data"></a>
</h2>
<p>A small dataset with 2 missing values in the first column will be
used to compare the numerical results from the 4 packages.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">67</span>, <span class="fl">90</span>, <span class="fl">98</span>, <span class="fl">120</span>,</span>
<span>             <span class="fl">55</span>, <span class="fl">71</span>, <span class="fl">93</span>, <span class="fl">102</span>, <span class="fl">129</span>,</span>
<span>             <span class="fl">65</span>, <span class="fl">76</span>, <span class="fl">95</span>, <span class="fl">105</span>, <span class="fl">134</span>,</span>
<span>             <span class="fl">50</span>, <span class="fl">80</span>, <span class="fl">102</span>, <span class="fl">130</span>, <span class="fl">138</span>,</span>
<span>             <span class="fl">60</span>, <span class="fl">82</span>, <span class="fl">97</span>, <span class="fl">135</span>, <span class="fl">151</span>,</span>
<span>             <span class="fl">65</span>, <span class="fl">89</span>, <span class="fl">106</span>, <span class="fl">137</span>, <span class="fl">153</span>,</span>
<span>             <span class="fl">75</span>, <span class="fl">95</span>, <span class="fl">117</span>, <span class="fl">133</span>, <span class="fl">155</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">5</span>, byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">B</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"G1"</span>,<span class="st">"G2"</span>,<span class="st">"G3"</span>,<span class="st">"G4"</span>,<span class="st">"G5"</span>,<span class="st">"G6"</span>,<span class="st">"G7"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">B</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"E1"</span>,<span class="st">"E2"</span>,<span class="st">"E3"</span>,<span class="st">"E4"</span>,<span class="st">"E5"</span><span class="op">)</span></span>
<span> </span>
<span><span class="va">B2</span> <span class="op">=</span> <span class="va">B</span></span>
<span><span class="va">B2</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="va">B2</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span></span>
<span><span class="va">B2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">B2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">same</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">a</span>,<span class="va">b</span>, <span class="va">tol</span><span class="op">=</span><span class="fl">1e-3</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span>, tol<span class="op">=</span><span class="va">tol</span>, check.attributes<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Since principal components are only unique up to a change of sign, a
small function <code>same()</code> has been defined to take absolute
values before calling <code>all.equal</code>. The <code>same()</code>
function will be used to compare results from the different functions.
In the next 3 sections, the results from the <code>nipals</code> package
are compared to the <code>ade4</code>, <code>plsdepot</code>, and
<code>mixOmics</code> packages respectively.</p>
</div>
<div class="section level2">
<h2 id="ade4">ade4<a class="anchor" aria-label="anchor" href="#ade4"></a>
</h2>
<p>The <code>ade4</code> package uses a maximum-likelihood scaling of
the data which divides by <code>n</code> instead of <code>n-1</code>, so
we need to scale the data by hand before using the <code>nipals</code>
package. Note: only for ade4 version &gt;= 1.7-10.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://pbil.univ-lyon1.fr/ADE-4/" class="external-link">ade4</a></span><span class="op">)</span></span>
<span><span class="va">made</span> <span class="op">&lt;-</span> <span class="fu">ade4</span><span class="fu">::</span><span class="fu">nipals</span><span class="op">(</span><span class="va">B2</span>, nf<span class="op">=</span><span class="fl">5</span>, rec<span class="op">=</span><span class="cn">TRUE</span>, niter<span class="op">=</span><span class="fl">500</span>, tol<span class="op">=</span><span class="fl">1e-9</span><span class="op">)</span></span>
<span></span>
<span><span class="va">B2a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">B2</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">/</span> <span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">x</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="va">n</span> <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mnip</span> <span class="op">&lt;-</span> <span class="fu">nipals</span><span class="fu">::</span><span class="fu"><a href="../reference/nipals.html">nipals</a></span><span class="op">(</span><span class="va">B2a</span>, ncomp<span class="op">=</span><span class="fl">5</span>, center<span class="op">=</span><span class="cn">FALSE</span>, scale<span class="op">=</span><span class="cn">FALSE</span>, </span>
<span>                       fitted<span class="op">=</span><span class="cn">TRUE</span>, maxiter<span class="op">=</span><span class="fl">500</span>, tol<span class="op">=</span><span class="fl">1e-9</span>, gramschmidt<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>The eigenvalues reported by <code>ade4</code> are the squared
singular values divided by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n-1</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># data</span></span>
<span><span class="fu">same</span><span class="op">(</span><span class="va">B2a</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">made</span><span class="op">$</span><span class="va">tab</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># TRUE</span></span>
<span></span>
<span><span class="co"># eigenvalues, ade4 uses squared singular values / n-1</span></span>
<span><span class="va">mnip</span><span class="op">$</span><span class="va">eig</span></span>
<span><span class="co"># [1] 5.2913781 2.2555596 1.1651281 0.2590878 0.1563175</span></span>
<span><span class="va">made</span><span class="op">$</span><span class="va">eig</span></span>
<span><span class="co"># [1] 4.666454778 0.847924398 0.226254436 0.011187921 0.004072542</span></span>
<span><span class="fu">same</span><span class="op">(</span><span class="va">mnip</span><span class="op">$</span><span class="va">eig</span> <span class="op">^</span> <span class="fl">2</span> <span class="op">/</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">B2a</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="va">made</span><span class="op">$</span><span class="va">eig</span><span class="op">)</span></span>
<span><span class="co"># TRUE</span></span>
<span></span>
<span><span class="co"># P loadings</span></span>
<span><span class="fu">same</span><span class="op">(</span><span class="va">mnip</span><span class="op">$</span><span class="va">loadings</span>, <span class="va">made</span><span class="op">$</span><span class="va">c1</span><span class="op">)</span></span>
<span><span class="co"># TRUE</span></span>
<span></span>
<span><span class="co"># T scores. For nipals, sweep IN the eigenvalues</span></span>
<span><span class="fu">same</span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/sweep.html" class="external-link">sweep</a></span><span class="op">(</span><span class="va">mnip</span><span class="op">$</span><span class="va">scores</span>, <span class="fl">2</span>, <span class="va">mnip</span><span class="op">$</span><span class="va">eig</span>, <span class="st">"*"</span><span class="op">)</span>, <span class="va">made</span><span class="op">$</span><span class="va">li</span><span class="op">)</span></span>
<span><span class="co"># TRUE</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plsdepot">plsdepot<a class="anchor" aria-label="anchor" href="#plsdepot"></a>
</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">plsdepot</span><span class="op">)</span></span>
<span><span class="va">mpls</span> <span class="op">&lt;-</span> <span class="fu">plsdepot</span><span class="fu">::</span><span class="fu">nipals</span><span class="op">(</span><span class="va">B2</span>, comps<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://kwstat.github.io/nipals/">nipals</a></span><span class="op">)</span></span>
<span><span class="va">mnip</span> <span class="op">&lt;-</span> <span class="fu">nipals</span><span class="fu">::</span><span class="fu"><a href="../reference/nipals.html">nipals</a></span><span class="op">(</span><span class="va">B2a</span>, ncomp<span class="op">=</span><span class="fl">5</span>, maxiter<span class="op">=</span><span class="fl">100</span>, tol<span class="op">=</span><span class="fl">1e-6</span>, gramschmidt<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>The <code>plsdepot</code> package reports squared singular
values.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># eigenvalues</span></span>
<span><span class="va">mnip</span><span class="op">$</span><span class="va">eig</span></span>
<span><span class="co"># [1] 4.8762167 2.0442757 1.0728055 0.2369607 0.1432779</span></span>
<span><span class="va">mpls</span><span class="op">$</span><span class="va">values</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="co"># [1] 3.963172007 0.696484184 0.191839875 0.009366425 0.003421661</span></span>
<span><span class="fu">same</span><span class="op">(</span><span class="va">mnip</span><span class="op">$</span><span class="va">eig</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">mpls</span><span class="op">$</span><span class="va">values</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="fl">6</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="co"># TRUE</span></span>
<span></span>
<span><span class="co"># P loadings</span></span>
<span><span class="va">mnip</span><span class="op">$</span><span class="va">loadings</span></span>
<span><span class="va">mpls</span><span class="op">$</span><span class="va">loadings</span></span>
<span><span class="fu">same</span><span class="op">(</span><span class="va">mnip</span><span class="op">$</span><span class="va">loadings</span>, <span class="va">mpls</span><span class="op">$</span><span class="va">loadings</span>, tol<span class="op">=</span><span class="fl">1e-2</span> <span class="op">)</span></span>
<span><span class="co"># TRUE</span></span>
<span></span>
<span><span class="co"># T scores</span></span>
<span><span class="va">mnip</span><span class="op">$</span><span class="va">scores</span></span>
<span><span class="va">mpls</span><span class="op">$</span><span class="va">scores</span></span>
<span><span class="fu">same</span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/sweep.html" class="external-link">sweep</a></span><span class="op">(</span><span class="va">mnip</span><span class="op">$</span><span class="va">scores</span>, <span class="fl">2</span>, <span class="va">mnip</span><span class="op">$</span><span class="va">eig</span>, <span class="st">"*"</span><span class="op">)</span>, <span class="va">mpls</span><span class="op">$</span><span class="va">scores</span><span class="op">)</span></span>
<span><span class="co"># TRUE</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="mixomics">mixOmics<a class="anchor" aria-label="anchor" href="#mixomics"></a>
</h2>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mixOmics</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://kwstat.github.io/nipals/">nipals</a></span><span class="op">)</span></span>
<span><span class="va">mnip</span> <span class="op">&lt;-</span> <span class="fu">nipals</span><span class="fu">::</span><span class="fu"><a href="../reference/nipals.html">nipals</a></span><span class="op">(</span><span class="va">B2</span>, gramschmidt<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">mmix</span> <span class="op">&lt;-</span> <span class="fu">mixOmics</span><span class="fu">::</span><span class="fu">nipals</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">B2</span><span class="op">)</span>, ncomp<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># eigenvalues</span></span>
<span><span class="va">mnip</span><span class="op">$</span><span class="va">eig</span></span>
<span><span class="va">mmix</span><span class="op">$</span><span class="va">eig</span></span>
<span><span class="fu">same</span><span class="op">(</span><span class="va">mnip</span><span class="op">$</span><span class="va">eig</span>, <span class="va">mmix</span><span class="op">$</span><span class="va">eig</span><span class="op">)</span></span>
<span><span class="co"># TRUE</span></span>
<span></span>
<span><span class="co"># P loadings</span></span>
<span><span class="va">mnip</span><span class="op">$</span><span class="va">loadings</span></span>
<span><span class="va">mmix</span><span class="op">$</span><span class="va">p</span></span>
<span><span class="fu">same</span><span class="op">(</span><span class="va">mnip</span><span class="op">$</span><span class="va">loadings</span>, <span class="va">mmix</span><span class="op">$</span><span class="va">p</span>, tol<span class="op">=</span><span class="fl">1e-2</span><span class="op">)</span></span>
<span><span class="co"># TRUE</span></span>
<span></span>
<span><span class="co"># T scores</span></span>
<span><span class="va">mnip</span><span class="op">$</span><span class="va">scores</span></span>
<span><span class="va">mmix</span><span class="op">$</span><span class="va">t</span></span>
<span><span class="fu">same</span><span class="op">(</span><span class="va">mnip</span><span class="op">$</span><span class="va">scores</span>, <span class="va">mmix</span><span class="op">$</span><span class="va">t</span>, tol<span class="op">=</span><span class="fl">1e-2</span><span class="op">)</span></span>
<span><span class="co"># TRUE</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="speed-comparison">Speed comparison<a class="anchor" aria-label="anchor" href="#speed-comparison"></a>
</h2>
<p>For the purpose of comparing performance of the functions, we
simulate a 100 x 100 matrix and insert one missing value.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">43</span><span class="op">)</span></span>
<span><span class="va">Bbig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">*</span><span class="fl">100</span><span class="op">)</span>, nrow<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">Bbig2</span> <span class="op">&lt;-</span> <span class="va">Bbig</span></span>
<span><span class="va">Bbig2</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span></code></pre></div>
<p>The <code>ade4::nipals</code> function uses <code>for</code> loops to
loop over the columns of <code>X</code>, which results in very slow
execution even when calculating only 1 principal component.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="fu">ade4</span><span class="fu">::</span><span class="fu">nipals</span><span class="op">(</span><span class="va">Bbig2</span>, nf<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="co"># Only 1 PC!</span></span>
<span><span class="co">##  user  system elapsed </span></span>
<span><span class="co">## 42.09    0.00   42.14 </span></span></code></pre></div>
<p>The <code>plsdepot::nipals</code> function is fast enough that all
100 PCs can be calculated.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="fu">plsdepot</span><span class="fu">::</span><span class="fu">nipals</span><span class="op">(</span><span class="va">Bbig2</span>, comps<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="co"># Only 1 PC !</span></span>
<span><span class="co">#   user  system elapsed </span></span>
<span><span class="co">#    0.5     0.0     0.5</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="fu">plsdepot</span><span class="fu">::</span><span class="fu">nipals</span><span class="op">(</span><span class="va">Bbig2</span>, comps<span class="op">=</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="co"># 100 PCs</span></span>
<span><span class="co">#   user  system elapsed </span></span>
<span><span class="co">#  30.19    0.00   30.18 </span></span></code></pre></div>
<p>The <code>mixOmics::nipals</code> function uses the
<code>crossprod</code> function and a few other tricks to improve
performance.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="fu">mixOmics</span><span class="fu">::</span><span class="fu">nipals</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">Bbig2</span><span class="op">)</span>, ncomp<span class="op">=</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="co"># 100 PCs</span></span>
<span><span class="co">#   user  system elapsed </span></span>
<span><span class="co">#  20.70    0.00   20.81 </span></span></code></pre></div>
<p>The <code><a href="../reference/nipals.html">nipals::nipals</a></code> function was optimized through
extensive testing and is about 5 times faster! Note that Gram-Scmidt is
turned off in order to make a fair comparison with other functions.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="fu">nipals</span><span class="fu">::</span><span class="fu"><a href="../reference/nipals.html">nipals</a></span><span class="op">(</span><span class="va">Bbig2</span>, ncomp<span class="op">=</span><span class="fl">100</span>, gramschmidt<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="co"># 100 PCs</span></span>
<span><span class="co">#   user  system elapsed </span></span>
<span><span class="co">#   2.93    0.00    2.93</span></span></code></pre></div>
<p>When Gram-Schmidt is turned on (which is the default setting), the
function is a bit slower.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="fu">nipals</span><span class="fu">::</span><span class="fu"><a href="../reference/nipals.html">nipals</a></span><span class="op">(</span><span class="va">Bbig2</span>, ncomp<span class="op">=</span><span class="fl">100</span>, gramschmidt<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="co"># 100 PCs</span></span>
<span><span class="co">#   user  system elapsed </span></span>
<span><span class="co">#    3.6     0.0     3.6 </span></span></code></pre></div>
<p>The <code><a href="../reference/empca.html">nipals::empca</a></code> function results here are VERY
tentative:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="fu"><a href="../reference/empca.html">empca</a></span><span class="op">(</span><span class="va">Bbig2</span>, ncomp<span class="op">=</span><span class="fl">100</span>, gramschmidt<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="co"># 100 PCs</span></span>
<span><span class="co">#   user  system elapsed </span></span>
<span><span class="co">#   1.03    0.00    1.03 </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="fu"><a href="../reference/empca.html">empca</a></span><span class="op">(</span><span class="va">Bbig2</span>, ncomp<span class="op">=</span><span class="fl">100</span>, gramschmidt<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="co"># 100 PCs</span></span>
<span><span class="co">#   user  system elapsed </span></span>
<span><span class="co">#  10.44    0.00   10.45 </span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kevin Wright.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
